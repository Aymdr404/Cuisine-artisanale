import{m as u,d,n as b,p as C,t as R,u as T,r as p,v as V,w as $,j as s,B as v,x as a,y as A,z as M}from"./index-CUDfL22c.js";const U=async(e,c)=>{try{const t=u(d,"posts",e);await b(t,{likes:R(c)})}catch(t){console.error("Error liking post: ",t)}},q=async(e,c)=>{try{const t=u(d,"posts",e);await b(t,{likes:C(c)})}catch(t){console.error("Error unliking post: ",t)}},O=({postId:e,title:c,content:t,createdAt:w,fromRequest:m=!1,visible:P=!0,userName:L})=>{const{user:y,role:N}=T(),[g,S]=p.useState([]),[h,o]=p.useState(!1),[i,x]=p.useState(P),l=y==null?void 0:y.uid,{showToast:n}=V();p.useEffect(()=>{const r=$(u(d,"posts",e),k=>{if(k.exists()){const j=k.data();S(j.likes||[]),x(j.visible!==!1)}});return()=>r()},[e]);const f=l?g.includes(l):!1,_=async()=>{if(!l){n({severity:"warn",summary:a.warning.default,detail:a.error.auth});return}o(!0);try{f?await q(e,l):await U(e,l)}catch{n({severity:"error",summary:a.error.default,detail:"Une erreur est survenue lors de l'action."})}o(!1)},E=async()=>{o(!0);try{const r=u(d,"posts",e);await b(r,{visible:!i}),x(!i),n({severity:"success",summary:a.success.default,detail:`Le post est maintenant ${i?"masqué":"visible"}.`})}catch{n({severity:"error",summary:a.error.default,detail:"Erreur lors du changement de visibilité."})}o(!1)},B=()=>{A({message:"Êtes-vous sûr de vouloir supprimer ce post ?",header:"Confirmation de suppression",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui",rejectLabel:"Non",accept:D})},D=async()=>{o(!0);try{const r=u(d,"posts",e);await M(r),n({severity:"success",summary:a.success.default,detail:a.success.delete})}catch{n({severity:"error",summary:a.error.default,detail:a.error.delete})}o(!1)};return s.jsxs("div",{className:`Post ${m?"Post_request":""} ${i?"":"Post-hidden"}`,children:[s.jsx("h1",{children:c}),s.jsx("p",{style:{whiteSpace:"pre-wrap"},children:t}),s.jsxs("section",{className:"Section_buttons",children:[!m&&s.jsx(v,{className:"Post_likeButton",onClick:_,disabled:h,severity:f?"danger":"secondary",icon:f?"pi pi-heart-fill":"pi pi-heart",label:g.length.toString()}),N==="admin"&&!m&&s.jsxs("div",{className:"Post_admin_actions",children:[s.jsx(v,{className:"Post_visibilityButton",label:i?"Masquer":"Afficher",icon:i?"pi pi-eye-slash":"pi pi-eye",onClick:E,disabled:h,severity:i?"warning":"success"}),s.jsx(v,{className:"Post_deleteButton",label:"Supprimer",icon:"pi pi-trash",onClick:B,disabled:h,severity:"danger"}),s.jsxs("span",{className:"post-date",children:[w," "]}),s.jsx("span",{className:"post-user",children:L})]})]})]})};export{O as default};
