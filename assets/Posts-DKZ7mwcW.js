const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Post-Ca7SYh8M.js","assets/index-BWNilCJ8.js","assets/index-BLC8gARZ.css","assets/Post-BB1Cct-4.css"])))=>i.map(i=>d[i]);
import{r as o,u as S,j as e,M as F,I,a as M,B as b,b as R,c as k,d as A,s as q,C as V,R as B,q as P,o as C,l as T,g as D,_ as Q,e as H}from"./index-BWNilCJ8.js";const O=["merde","putain","con","connard","salope","bite","cul","enculé","fdp","ta gueule","nique","bordel","chiant","emmerde","enculeur","pédé","gouine","batard","enculée","test","penis","fuck","shit","bitch","ass","dick","bastard","crap","slut","motherfucker","cunt","damn","pussy","prick","whore","cock","retard","jerk","douche","tests"],E=l=>{const t=l.toLowerCase();return O.some(i=>t.includes(i))},U=({closeForm:l})=>{const[t,i]=o.useState(""),[r,c]=o.useState(""),[d,f]=o.useState(!1),[p,h]=o.useState(null),{user:x}=S(),j=async u=>{if(u.preventDefault(),h(null),!(!t.trim()||!r.trim()||!x)){if(E(t)||E(r)){h("Le contenu contient des mots inappropriés. Veuillez modifier votre message.");return}f(!0);try{await R(k(A,"posts"),{title:t.trim(),content:r,createdAt:q(),userId:x.uid,userName:x.displayName||"Anonymous",visible:!1}),l()}catch(g){console.error("Error adding post:",g),h("Une erreur est survenue lors de la publication du post.")}finally{f(!1)}}};return e.jsx("div",{className:"AddPostForm",children:e.jsxs("form",{className:"formPost",onSubmit:j,children:[e.jsx("h3",{children:"Nouveau Post"}),p&&e.jsx(F,{severity:"error",text:p,style:{marginBottom:"1rem"}}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",children:"Titre"}),e.jsx(I,{id:"title",value:t,onChange:u=>i(u.target.value),placeholder:"Entrez le titre",required:!0,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",children:"Contenu"}),e.jsx(M,{id:"content",value:r,onChange:u=>c(u.target.value),placeholder:"Écrivez votre post ici...",required:!0,rows:5,autoResize:!0,style:{whiteSpace:"pre-wrap"}})]}),e.jsxs("div",{className:"buttons-form",children:[e.jsx(b,{type:"button",label:"Annuler",className:"p-button-outlined",onClick:l,disabled:d}),e.jsx(b,{type:"submit",label:"Publier",loading:d,disabled:!t.trim()||!r.trim()})]})]})})},Y=()=>{const[l,t]=o.useState(!1),{user:i}=S(),r=()=>{t(!0)},c=()=>{t(!1)};return e.jsxs("div",{className:"AddPost",children:[e.jsxs("div",{className:"desktop-post",children:[e.jsx("h2",{children:"Ajouter un post"}),e.jsx("p",{children:"Partagez vos pensées avec le monde !"}),e.jsx(b,{onClick:r,disabled:!i,children:"Ajouter un post"}),!i&&e.jsx("p",{children:"Vous devez être connecté pour ajouter un post"})]}),e.jsx("div",{className:"mobile-floating-button",onClick:r,children:e.jsx(b,{icon:"pi pi-plus","aria-label":"Ajouter un post",className:"p-button-rounded p-button-lg"})}),l&&e.jsx(U,{closeForm:c})]})},$=B.lazy(()=>Q(()=>import("./Post-Ca7SYh8M.js"),__vite__mapDeps([0,1,2,3]))),v=5,J=()=>{const[l,t]=o.useState([]),[i,r]=o.useState(null),[c,d]=o.useState(!1),[f,p]=o.useState(!0),[h,x]=o.useState(!1),{role:j,user:u}=S(),g=s=>s.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),_=async()=>{d(!0);try{const s=P(k(A,"posts"),C("createdAt","desc"),T(v)),a=await D(s),y=a.docs.map(m=>{const n=m.data();return{id:m.id,title:n.title,content:n.content,createdAt:n.createdAt.toDate(),visible:n.visible!==!1,userName:n.userName}});t(y),r(a.docs[a.docs.length-1]),p(a.size===v)}catch(s){console.error("Error fetching posts:",s)}d(!1)},z=async()=>{if(!(!i||c)){d(!0);try{const s=P(k(A,"posts"),C("createdAt","desc"),H(i),T(v)),a=await D(s),y=a.docs.map(m=>{const n=m.data();return{id:m.id,title:n.title,content:n.content,createdAt:n.createdAt.toDate(),visible:n.visible!==!1,userName:n.userName}});t(m=>[...m,...y]),r(a.docs[a.docs.length-1]),p(a.size===v)}catch(s){console.error("Error loading more posts:",s)}d(!1)}},w=()=>x(window.scrollY>300),L=()=>window.scrollTo({top:0,behavior:"smooth"});o.useEffect(()=>(_(),window.addEventListener("scroll",w),()=>window.removeEventListener("scroll",w)),[u,j]);const N=o.useMemo(()=>l.filter(s=>s.visible||j==="admin"),[l,j]);return e.jsxs("div",{className:"Posts",children:[e.jsx(V,{}),e.jsxs("section",{className:"Posts_section",children:[c&&N.length===0&&Array.from({length:v}).map((s,a)=>e.jsxs("div",{className:"post-skeleton",children:[e.jsx("div",{className:"skeleton-title"}),e.jsx("div",{className:"skeleton-content"})]},a)),N.map(s=>e.jsx(o.Suspense,{fallback:e.jsxs("div",{className:"post-skeleton",children:[e.jsx("div",{className:"skeleton-title"}),e.jsx("div",{className:"skeleton-content"})]}),children:e.jsx($,{postId:s.id,title:s.title,content:s.content,createdAt:g(s.createdAt),visible:s.visible,userName:s.userName})},s.id)),e.jsx("section",{className:"LoadMore_section",children:c&&N.length>0?e.jsxs("div",{className:"loading-spinner",children:[e.jsx("i",{className:"pi pi-spinner"}),e.jsx("span",{children:"Chargement des posts..."})]}):f?e.jsx(b,{onClick:z,icon:"pi pi-plus",label:"Charger plus de posts",className:"p-button-outlined"}):e.jsxs("div",{className:"no-more-posts",children:[e.jsx("i",{className:"pi pi-check-circle",style:{marginRight:"0.5rem"}}),"Vous avez vu tous les posts !"]})})]}),e.jsx("section",{className:"AddPost_section",children:e.jsx(Y,{})}),e.jsx("button",{className:`scroll-top-button ${h?"visible":""}`,onClick:L,"aria-label":"Retour en haut",children:e.jsx("i",{className:"pi pi-angle-up",style:{fontSize:"1.5rem"}})})]})};export{J as default};
