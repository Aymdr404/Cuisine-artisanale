(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5262],{630:(e,r,t)=>{"use strict";t.d(r,{Jk:()=>i,iG:()=>c});var a=t(5973),s=t(9708);let i=async(e,r)=>{try{let t=(0,s.H9)(a.db,"recipes",e);if(!(await (0,s.x7)(t)).exists())return void console.warn("Recette non trouv\xe9e");let i=(0,s.H9)(a.db,"users",r),c=await (0,s.x7)(i);if(!c.exists())return void console.warn("Utilisateur non trouv\xe9");let n=c.data(),l=n.displayName||n.email||"Anonyme",o="".concat(r,"_").concat(e),u=(0,s.H9)(a.db,"likes",o);(await (0,s.x7)(u)).exists()?console.log("User a d\xe9j\xe0 lik\xe9 cette recette"):(await (0,s.BN)(u,{userId:r,userName:l,recetteId:e,createdAt:(0,s.O5)()}),console.log("Like ajout\xe9: ".concat(l," a lik\xe9 la recette ").concat(e)))}catch(e){console.error("Error liking recipe: ",e)}},c=async(e,r)=>{try{let t="".concat(r,"_").concat(e),i=(0,s.H9)(a.db,"likes",t);(await (0,s.x7)(i)).exists()?(await (0,s.kd)(i),console.log("Like supprim\xe9: userId ".concat(r," pour recette ").concat(e))):console.warn("Like non trouv\xe9")}catch(e){console.error("Error unliking recipe: ",e)}}},1715:()=>{},2718:(e,r,t)=>{"use strict";t.d(r,{A:()=>u,O:()=>o});var a=t(5155),s=t(2115),i=t(5973),c=t(3885),n=t(9708);let l=(0,s.createContext)(void 0),o=e=>{let{children:r}=e,[t,o]=(0,s.useState)(null),[u,d]=(0,s.useState)(null),[p,m]=(0,s.useState)(!0),[h,g]=(0,s.useState)(null),w=async e=>{let r=(0,n.aU)(),t=(0,n.H9)(r,"users",e),a=await (0,n.x7)(t);return a.exists()?a.data().role:null},f=async(e,r)=>{let t=(0,n.aU)(),a=(0,n.H9)(t,"users",e);await (0,n.BN)(a,{email:r,role:"user",createdAt:new Date})};(0,s.useEffect)(()=>{let e=(0,c.hg)(i.j,async e=>{try{if(e){o(e);let r=await w(e.uid);r?d(r):(await f(e.uid,e.email||""),d("user"))}else o(null),d(null)}catch(e){console.error("Error in auth state change:",e),g(e instanceof Error?e.message:"An error occurred")}finally{m(!1)}});return()=>e()},[]);let v=async()=>{try{g(null),await (0,c.CI)(i.j),d(null),window.location.href="/Cuisine-artisanale/"}catch(e){console.error("Error signing out:",e),g(e instanceof Error?e.message:"Error signing out")}},x=async()=>{try{g(null);let e=new c.HF,r=await (0,c.df)(i.j,e);r.user&&(await w(r.user.uid)||(await f(r.user.uid,r.user.email||""),d("user")))}catch(e){throw console.error("Error signing in with Google:",e),g(e instanceof Error?e.message:"Error signing in with Google"),e}};return(0,a.jsx)(l.Provider,{value:{user:t,role:u,logout:v,signInWithGoogle:x,loading:p,error:h},children:r})},u=()=>{let e=(0,s.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},3769:(e,r,t)=>{"use strict";t.d(r,{P:()=>a,g:()=>s});let a=(e,r)=>{e.current&&e.current.show({severity:r.severity,summary:r.summary,detail:r.detail,life:r.life||1e3})},s={success:{default:"Succ\xe8s",create:"Cr\xe9ation r\xe9ussie",update:"Mise \xe0 jour r\xe9ussie",delete:"Suppression r\xe9ussie",accept:"Acceptation r\xe9ussie",reject:"Rejet r\xe9ussi"},error:{default:"Erreur",create:"Erreur lors de la cr\xe9ation",update:"Erreur lors de la mise \xe0 jour",delete:"Erreur lors de la suppression",auth:"Vous devez \xeatre connect\xe9",accept:"Erreur lors de l'acceptation",reject:"Erreur lors du rejet"},warning:{default:"Attention"},info:{default:"Information",reject:"Rejet effectu\xe9"}}},4064:(e,r,t)=>{"use strict";t.d(r,{d:()=>o,t:()=>l});var a=t(5155),s=t(2115),i=t(8574),c=t(3769);let n=(0,s.createContext)(void 0),l=e=>{let{children:r}=e,t=(0,s.useRef)(null);return(0,a.jsxs)(n.Provider,{value:{showToast:e=>{(0,c.P)(t,e)}},children:[r,(0,a.jsx)(i.y,{ref:t})]})},o=()=>{let e=(0,s.useContext)(n);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}},5262:(e,r,t)=>{"use strict";t.d(r,{A:()=>h});var a=t(5155),s=t(2115);t(1715);var i=t(29),c=t(2619),n=t.n(c),l=t(2718),o=t(630),u=t(6596),d=t(5973),p=t(4064),m=t(6690);let h=e=>{let{recetteId:r,title:t,type:c,fromRequest:h=!1,images:g=[],position:w=""}=e,{user:f,role:v}=(0,l.A)(),{showToast:x}=(0,p.d)(),[y,j]=(0,s.useState)(0),[b,k]=(0,s.useState)(!1),[E,N]=(0,s.useState)(null),[C,I]=(0,s.useState)(0),A=null==f?void 0:f.uid;(0,s.useEffect)(()=>{let e=(0,u.rJ)(d.db,"likes"),t=(0,u.P)(e,(0,u._M)("recetteId","==",r)),a=(0,u.aQ)(t,e=>{j(e.size),A?k(e.docs.some(e=>e.data().userId===A)):k(!1)});return()=>a()},[r,A]),(0,s.useEffect)(()=>{let e=(0,u.rJ)(d.db,"reviews"),t=(0,u.P)(e,(0,u._M)("recipeId","==",r),(0,u.My)("createdAt","desc")),a=(0,u.aQ)(t,e=>{let r=e.docs.map(e=>e.data());I(r.length),r.length>0?N(parseFloat((r.reduce((e,r)=>e+(r.rating||0),0)/r.length).toFixed(1))):N(null)});return()=>a()},[r]);let S=async()=>{if(!A)return void x({severity:"warn",summary:"Connexion requise",detail:"Vous devez \xeatre connect\xe9 pour aimer une recette"});try{b?await (0,o.iG)(r,A):await (0,o.Jk)(r,A)}catch(e){console.error("Erreur lors du like:",e),x({severity:"error",summary:"Erreur",detail:"Une erreur est survenue lors du like"})}},_=async()=>{try{let e=(0,u.H9)(d.db,"recipesRequest",r),t=await (0,u.x7)(e);if(!t.exists())return;let a=t.data();(await (0,u.gS)((0,u.rJ)(d.db,"recipes"),{...a,createdAt:new Date})).id&&await P()}catch(e){console.error("Error handling recipe request:",e)}},P=async()=>{try{await (0,u.kd)((0,u.H9)(d.db,"recipesRequest",r))}catch(e){console.error("Error declining recipe:",e)}};return(0,a.jsxs)("article",{className:"recipe-card ".concat(h?"recipe-request":""),children:[(0,a.jsx)("div",{className:"recipe-image-container",children:0===g.length?(0,a.jsx)("div",{className:"recipe-placeholder",children:"Pas d'image"}):(0,a.jsx)("img",{src:g[0],alt:t,className:"recipe-image",width:600,height:400,loading:"lazy"})}),(0,a.jsxs)("div",{className:"recipe-content",children:[(0,a.jsx)("h2",{className:"recipe-title",children:t}),(0,a.jsxs)("div",{className:"recipe-tags",children:[(0,a.jsx)("span",{className:"recipe-type",children:c}),w&&(0,a.jsxs)("span",{className:"recipe-location",children:["\uD83D\uDCCD ",w]})]}),null!==E&&(0,a.jsxs)("div",{className:"recipe-rating",children:[(0,a.jsx)(m.G,{value:E,readOnly:!0,cancel:!1}),(0,a.jsxs)("span",{className:"rating-info",children:["(",C," avis)"]})]}),(0,a.jsxs)("div",{className:"recipe-actions",children:[h&&"admin"===v?(0,a.jsxs)("div",{className:"admin-actions",children:[(0,a.jsx)(i.$,{label:"Accepter",icon:"pi pi-check",onClick:_,className:"accept-button"}),(0,a.jsx)(i.$,{label:"Refuser",icon:"pi pi-times",onClick:P,className:"decline-button"})]}):null,(0,a.jsx)("div",{className:"main-actions",children:!h&&(0,a.jsxs)("div",{className:"Post_admin_actions",children:[(0,a.jsx)(n(),{href:"/recettes?id=".concat(r),className:"view-recipe",children:(0,a.jsx)(i.$,{label:"Voir la recette",icon:"pi pi-eye",className:"p-button-primary view-button"})}),(0,a.jsx)(i.$,{className:"Post_likeButton",onClick:S,severity:b?"danger":"secondary",icon:b?"pi pi-heart-fill":"pi pi-heart",label:y.toString()})]})})]})]})]})}},5973:(e,r,t)=>{"use strict";t.d(r,{I:()=>u,db:()=>o,j:()=>l});var a=t(2078),s=t(9708),i=t(8134),c=t(3885);let n=(0,a.Wp)({apiKey:"AIzaSyCRqPaeQ_8kRByuf8l9_Fkcbmdgy_0aWI4",authDomain:"recettes-cuisine-a1bf2.firebaseapp.com",projectId:"recettes-cuisine-a1bf2",storageBucket:"recettes-cuisine-a1bf2.firebasestorage.app",messagingSenderId:"854150054780",appId:"1:854150054780:web:e3866880aea3e01d5c1af9",measurementId:"G-1J6YNX5LZM"}),l=(0,c.xI)(n),o=(0,s.aU)(n),u=(0,i.c7)(n)}}]);