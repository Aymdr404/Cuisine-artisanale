(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7238],{1419:()=>{},3437:()=>{},4698:(e,t,r)=>{Promise.resolve().then(r.bind(r,6885))},5119:()=>{},6885:(e,t,r)=>{"use strict";r.d(t,{default:()=>I});var s=r(5155),i=r(63),a=r(2115);r(5119),r(3437);var n=r(6967),l=r(6218),c=r(29),o=r(4340);let d=()=>{let[e,t]=(0,a.useState)(null),[r,d]=(0,a.useState)(null),[u,p]=(0,a.useState)([]),[m,h]=(0,a.useState)(""),[v,x]=(0,a.useState)(!1),g=(0,i.useRouter)();(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("https://geo.api.gouv.fr/departements"),t=await e.json();p(t)}catch(e){console.error("Error fetching departements:",e)}})()},[]);let j=()=>{x(!0);let t=new URLSearchParams;m&&t.append("keywords",m),e&&t.append("type",e),(null==r?void 0:r.code)&&t.append("position",r.code);let s=t.toString();g.push(s?"/recettes?".concat(s):"/recettes"),x(!1)};return(0,s.jsxs)("div",{className:"Filtre",children:[(0,s.jsx)("h2",{children:"Filtrer les recettes"}),(0,s.jsxs)("section",{className:"filtre_input",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{children:"Nom de la recette"}),(0,s.jsxs)("span",{className:"p-input-icon-left",children:[(0,s.jsx)("i",{className:"pi pi-search"}),(0,s.jsx)(o.S,{placeholder:"Rechercher une recette...",value:m,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"===e.key&&j()}})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{children:"Type de recette"}),(0,s.jsx)("div",{className:"Filtre_type",children:[{id:1,name:"Entr\xe9e"},{id:2,name:"Plat"},{id:3,name:"Dessert"},{id:4,name:"Boisson"}].map(r=>(0,s.jsxs)("div",{children:[(0,s.jsx)(n.a,{inputId:r.id.toString(),name:"type",value:r.name,onChange:e=>t(e.value),checked:e===r.name}),(0,s.jsx)("label",{htmlFor:r.id.toString(),children:r.name})]},r.id))})]}),(0,s.jsxs)("div",{className:"formRecette_region",children:[(0,s.jsx)("h3",{children:"D\xe9partement"}),(0,s.jsx)(l.m,{id:"position",value:r,options:[{nom:"Tous les d\xe9partements",code:""},...u],onChange:e=>d(e.value),optionLabel:"nom",placeholder:"S\xe9lectionner un d\xe9partement",className:"w-full"})]})]}),(0,s.jsxs)("div",{className:"filtre_buttons",children:[(0,s.jsx)(c.$,{label:"Filtrer",icon:"pi pi-filter",loading:v,onClick:j}),(0,s.jsx)(c.$,{label:"R\xe9initialiser",icon:"pi pi-refresh",className:"p-button-secondary",onClick:()=>{h(""),t(null),d(null),g.push("/recettes")},disabled:v})]})]})};var u=r(5262);r(9223);var p=r(2718);let m=()=>{let{user:e}=(0,p.A)(),t=(0,i.useRouter)();return(0,s.jsxs)("div",{className:"AddRecette",children:[(0,s.jsx)("h2",{children:"Ajouter une recette"}),(0,s.jsx)("p",{children:"Partage tes recettes avec le monde !"}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)(c.$,{onClick:()=>{t.push("/recettes/add-recipe")},disabled:!e,children:"Ajouter une recette"}),!e&&(0,s.jsx)("h3",{children:"Vous devez \xeatre connect\xe9 pour ajouter un post"})]})};var h=r(5973),v=r(9708);let x=()=>{let[e,t]=(0,a.useState)([]),r=(0,i.useSearchParams)(),[n,l]=(0,a.useState)(new Map);(0,a.useEffect)(()=>{c()},[r.toString()]);let c=async()=>{try{let e=(0,v.rJ)(h.db,"recipes"),s=r.get("type"),i=r.get("position"),a=r.get("keywords"),n=new Map;if(a)for(let t of a.split(" ")){let r=function(e){let t=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),r=new Set([t]);return t.endsWith("s")?r.add(t.slice(0,-1)):r.add(t+"s"),t.endsWith("ie")&&r.add(t.slice(0,-2)+"y"),t.endsWith("y")&&r.add(t.slice(0,-1)+"ie"),Array.from(r)}(t);if(0===r.length)continue;let s=!1;console.log();let i=(0,v.P)(e,(0,v._M)("titleKeywords","array-contains-any",r)),a=await (0,v.GG)(i);a.empty&&console.log("⚠️ Aucun r\xe9sultat Firestore pour :",r),a.empty||(s=!0),a.forEach(e=>{var t;let r=e.data();n.set(e.id,{title:r.title,type:r.type,position:r.position,recetteId:e.id,images:null!=(t=r.images)?t:[]})}),s||(console.log('⚠️ Aucun match Firestore pour "'.concat(t,'", fallback fuzzy')),(await (0,v.GG)(e)).forEach(e=>{var t;let r=e.data();n.set(e.id,{title:r.title,type:r.type,position:r.position,recetteId:e.id,images:null!=(t=r.images)?t:[]})}))}else(await (0,v.GG)(e)).forEach(e=>{var t;let r=e.data();n.set(e.id,{title:r.title,type:r.type,position:r.position,recetteId:e.id,images:null!=(t=r.images)?t:[]})});let l=Array.from(n.values());if(a){let e=a.toLowerCase().split(" ");l=l.map(t=>{let r=t.title.toLowerCase(),s=Math.max(...e.map(e=>(function(e,t){let r=Math.max(e.length,t.length);return 1-function(e,t){let r=e.length,s=t.length,i=Array.from({length:r+1},()=>Array(s+1).fill(0));for(let e=0;e<=r;e++)i[e][0]=e;for(let e=0;e<=s;e++)i[0][e]=e;for(let a=1;a<=r;a++)for(let r=1;r<=s;r++){let s=+(e[a-1]!==t[r-1]);i[a][r]=Math.min(i[a-1][r]+1,i[a][r-1]+1,i[a-1][r-1]+s)}return i[r][s]}(e.toLowerCase(),t.toLowerCase())/r})(e,r)));return{...t,score:s}}).filter(t=>t.score>=.6||e.some(e=>t.title.toLowerCase().includes(e))).sort((e,t)=>t.score-e.score),console.log("R\xe9sultats filtr\xe9s :",l)}s&&(l=l.filter(e=>e.type===s)),i&&(l=l.filter(e=>e.position===i)),t(l)}catch(e){console.error("Error getting recettes: ",e)}};return(0,a.useEffect)(()=>{fetch("https://geo.api.gouv.fr/departements").then(e=>e.json()).then(e=>{l(new Map(e.map(e=>[e.code,e.nom])))})},[]),(0,s.jsxs)("div",{className:"Recettes",children:[(0,s.jsxs)("section",{className:"filter_section",children:[(0,s.jsx)(d,{}),(0,s.jsx)(m,{})]}),(0,s.jsxs)("section",{className:"recettes_section",children:[0===e.length&&!e&&Array.from({length:5}).map((e,t)=>(0,s.jsxs)("div",{className:"recette-skeleton",children:[(0,s.jsx)("div",{className:"skeleton-image"}),(0,s.jsx)("div",{className:"skeleton-title"}),(0,s.jsx)("div",{className:"skeleton-content"})]},t)),e.map((e,t)=>(0,s.jsx)(u.A,{recetteId:e.recetteId,title:e.title,type:e.type,images:e.images,position:n.get(e.position)||"Inconnu"},t))]})]})};r(1419);var g=r(2580),j=r.n(g);r(9117);let y=e=>{let{url:t}=e;return t?/tiktok\.com/.test(t)?(0,s.jsx)("div",{className:"video-embed-tiktok",children:(0,s.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"video-embed-tiktok-link",children:"Voir la vid\xe9o sur TikTok"})}):(0,s.jsx)("div",{className:"video-embed-player",children:(0,s.jsx)(j(),{url:t,controls:!0,width:"100%"})}):null};var f=r(6596),N=r(630),w=r(4547),b=r(4064),k=r(6690),E=r(3303);let S=async e=>{let{title:t,description:r}=e,s=window.location.href;if(navigator.share)try{await navigator.share({title:t,text:r,url:s});return}catch(e){"AbortError"!==e.name&&console.error("Erreur lors du partage:",e)}try{await navigator.clipboard.writeText(s)}catch(e){throw console.error("Erreur lors de la copie du lien:",e),Error("Impossible de partager la recette")}},C=()=>{let[e,t]=(0,a.useState)(null),r=(0,i.useSearchParams)(),n=null==r?void 0:r.get("id"),l=(0,i.useRouter)(),{role:o,user:d}=(0,p.A)(),{showToast:u}=(0,b.d)(),[m,v]=(0,a.useState)(0),[x,g]=(0,a.useState)(!1),j=null==d?void 0:d.uid,[C,I]=a.useState(null),[A,P]=(0,a.useState)(new Map),[T,M]=(0,a.useState)(0),_=(0,a.useRef)(null),[R,z]=(0,a.useState)([]),[F,D]=(0,a.useState)(""),[$,G]=(0,a.useState)(null),L=async e=>{try{let r=(0,f.H9)(h.db,"recipes",e),s=await (0,f.x7)(r);if(!s.exists())return void console.log("Pas de recette trouv\xe9e avec cet ID");let i=s.data();t(e);let a=await Promise.all(i.recipeParts.map(async e=>{let t=(await Promise.all(e.ingredients.map(async e=>{let t=(0,f.H9)(h.db,"ingredients",e.id),r=await (0,f.x7)(t);if(!r.exists())return console.warn("Ingr\xe9dient avec l'ID ".concat(e.id," introuvable")),null;{let t=r.data();return{id:e.id,name:t.name,quantity:e.quantity,unit:t.unit}}}))).filter(e=>null!==e);return{...e,ingredients:t}}));I({...i,recipeParts:a})}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration de la recette :",e)}};(0,a.useEffect)(()=>{n&&L(n)},[n]),(0,a.useEffect)(()=>{fetch("https://geo.api.gouv.fr/departements").then(e=>e.json()).then(e=>{P(new Map(e.map(e=>[e.code,e.nom])))})},[]),(0,a.useEffect)(()=>{if(!e)return;let t=(0,f.rJ)(h.db,"likes"),r=(0,f.P)(t,(0,f._M)("recetteId","==",e)),s=(0,f.aQ)(r,e=>{v(e.size),j?g(e.docs.some(e=>e.data().userId===j)):g(!1)});return()=>s()},[e,j]),(0,a.useEffect)(()=>((null==C?void 0:C.images)&&C.images.length>1&&(_.current=setInterval(()=>{M(e=>{var t,r;return e===(null!=(r=null==C||null==(t=C.images)?void 0:t.length)?r:0)-1?0:e+1})},5e3)),()=>{_.current&&clearInterval(_.current)}),[null==C?void 0:C.images]),(0,a.useEffect)(()=>{var e,t;if(!C)return;let r={"@context":"https://schema.org","@type":"Recipe",name:C.title,image:(null==(e=C.images)?void 0:e[0])||"",author:{"@type":"Person",name:(null==d?void 0:d.displayName)||"Auteur inconnu"},recipeCuisine:A.get(C.position)||"France",recipeCategory:C.type,prepTime:"PT".concat(C.preparationTime,"M"),cookTime:"PT".concat(C.cookingTime,"M"),recipeIngredient:C.recipeParts.flatMap(e=>e.ingredients.map(e=>"".concat(e.quantity," ").concat(e.unit," ").concat(e.name))),recipeInstructions:C.recipeParts.flatMap(e=>e.steps.map(e=>({"@type":"HowToStep",text:e}))),video:C.video?{"@type":"VideoObject",name:C.title,description:"Vid\xe9o de la recette ".concat(C.title),thumbnailUrl:(null==(t=C.images)?void 0:t[0])||"",uploadDate:new Date().toISOString(),contentUrl:C.video}:void 0},s=document.getElementById("jsonld-recipe");s&&s.remove();let i=document.createElement("script");return i.id="jsonld-recipe",i.type="application/ld+json",i.innerHTML=JSON.stringify(r),document.head.appendChild(i),()=>{let e=document.getElementById("jsonld-recipe");e&&e.remove()}},[C,A]),(0,a.useEffect)(()=>{if(!e)return;let t=(0,f.rJ)(h.db,"reviews"),r=(0,f.P)(t,(0,f._M)("recipeId","==",e),(0,f.My)("createdAt","desc")),s=(0,f.aQ)(r,e=>{z(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>s()},[e]);let O=async()=>{if(e)try{await (0,f.kd)((0,f.H9)(h.db,"recipes",e)),u({severity:"success",summary:"Succ\xe8s",detail:"Recette supprim\xe9e avec succ\xe8s"}),l.push("/recettes")}catch(e){console.error("Erreur lors de la suppression de la recette :",e),u({severity:"error",summary:"Erreur",detail:"Erreur lors de la suppression de la recette"})}},q=async()=>{if(!j)return void u({severity:"warn",summary:"Connexion requise",detail:"Vous devez \xeatre connect\xe9 pour aimer une recette"});if(!e)return void u({severity:"error",summary:"Erreur",detail:"Impossible de trouver la recette"});try{x?await (0,N.iG)(e,j):await (0,N.Jk)(e,j)}catch(e){console.error("Erreur lors du like:",e),u({severity:"error",summary:"Erreur",detail:"Une erreur est survenue lors du like"})}},V=async()=>{if(!(null==C?void 0:C.title)||!e)return void u({severity:"warn",summary:"Erreur",detail:"Impossible de partager cette recette"});try{var t;await S({title:C.title,description:"D\xe9couvrez la recette ".concat(C.title," sur Cuisine Artisanale"),recipeId:e,imageUrl:null==(t=C.images)?void 0:t[0]}),u({severity:"success",summary:"Succ\xe8s",detail:"Recette partag\xe9e ou lien copi\xe9 !"})}catch(e){console.error("Erreur lors du partage:",e),u({severity:"error",summary:"Erreur",detail:"Impossible de partager la recette"})}},H=async()=>{if(!j)return void u({severity:"warn",summary:"Connexion requise",detail:"Connectez-vous pour laisser un avis"});if(!e||!F.trim()||!$)return void u({severity:"warn",summary:"Champs manquants",detail:"Ajoutez une note et un message"});try{let t=(0,f.rJ)(h.db,"reviews");await (0,f.gS)(t,{recipeId:e,userId:j,userName:(null==d?void 0:d.displayName)||"Utilisateur",message:F.trim(),rating:$,createdAt:(0,f.O5)()}),D(""),G(null),u({severity:"success",summary:"Merci !",detail:"Votre avis a \xe9t\xe9 ajout\xe9"})}catch(e){console.error("Erreur lors de l'ajout de l'avis :",e),u({severity:"error",summary:"Erreur",detail:"Impossible d’ajouter l’avis"})}},J=R.length>0?(R.reduce((e,t)=>e+(t.rating||0),0)/R.length).toFixed(1):null,U=async e=>{try{await (0,f.kd)((0,f.H9)(h.db,"reviews",e)),z(t=>t.filter(t=>t.id!==e)),u({severity:"success",summary:"Suppr",detail:"Avis supprimer"})}catch(e){u({severity:"error",summary:"Erreur",detail:"Avis pas supprimer"})}};return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"RecetteDesc",children:[(0,s.jsx)(w.T,{}),(0,s.jsxs)("div",{className:"recette-desc-button-container",children:[(0,s.jsxs)("div",{className:"recette-desc-button-container-left",children:[(0,s.jsx)(c.$,{icon:"pi pi-arrow-left",onClick:()=>l.back(),className:"p-button-text"}),(0,s.jsx)(c.$,{icon:"pi pi-home",onClick:()=>l.push("/"),className:"p-button-text"}),(0,s.jsx)(c.$,{icon:x?"pi pi-heart-fill":"pi pi-heart",onClick:q,className:"p-button-text",severity:x?"danger":"info"}),(0,s.jsx)(c.$,{icon:"pi pi-share-alt",onClick:V,className:"p-button-text",tooltip:"Partager cette recette"})]}),"admin"===o&&(0,s.jsxs)("div",{className:"recette-desc-admin-buttons",children:[(0,s.jsx)(c.$,{icon:"pi pi-pencil",onClick:()=>l.push("/recettes/".concat(e,"/edit")),className:"p-button-text"}),(0,s.jsx)(c.$,{icon:"pi pi-trash",onClick:()=>{(0,w.Z)({message:"\xcates-vous s\xfbr de vouloir supprimer cette recette ?",header:"Confirmation de suppression",icon:"pi pi-exclamation-triangle",accept:O,reject:()=>{}})},className:"p-button-text p-button-danger"})]})]}),(0,s.jsx)("h1",{className:"recette-desc-title",children:null==C?void 0:C.title}),(0,s.jsxs)("div",{className:"recette-overall-rating",children:[J&&(0,s.jsxs)("div",{className:"recette-average-rating-display",children:[(0,s.jsx)(k.G,{value:parseFloat(J),readOnly:!0,cancel:!1}),(0,s.jsxs)("span",{className:"rating-text",children:[J," / 5 (",R.length," avis)"]})]}),!J&&(0,s.jsx)("p",{className:"no-rating-text",children:"Aucun avis pour le moment"})]}),(0,s.jsxs)("div",{className:"recette-desc-description",children:[(0,s.jsxs)("div",{className:"recette-desc-info",children:[(0,s.jsxs)("div",{className:"recette-desc-info-left",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Type:"})," ",null==C?void 0:C.type]}),(null==C?void 0:C.position)&&(0,s.jsx)("div",{className:"recette-desc-position",children:(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Departement:"})," ",A.get(C.position)||"Inconnu"]})}),(0,s.jsxs)("div",{className:"recette-desc-timing",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("i",{className:"pi pi-clock"}),(0,s.jsx)("strong",{children:"Temps de pr\xe9paration:"})," ",null==C?void 0:C.preparationTime," min"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("i",{className:"pi pi-hourglass"}),(0,s.jsx)("strong",{children:"Temps de cuisson:"})," ",null==C?void 0:C.cookingTime," min"]})]}),(null==C?void 0:C.video)&&(0,s.jsxs)("h3",{className:"recette-desc-video",children:[(0,s.jsx)("strong",{children:"Vid\xe9o associ\xe9e :"}),(0,s.jsx)(y,{url:C.video})]})]}),(0,s.jsx)("div",{className:"recette-desc-info-right",children:(null==C?void 0:C.images)&&C.images.length>0&&(0,s.jsxs)("div",{className:"recette-desc-gallery",children:[(0,s.jsx)("div",{className:"recette-desc-main-image",children:(0,s.jsx)("img",{src:C.images[T],alt:"".concat(C.title," - Image ").concat(T+1)})}),C.images.length>1&&(0,s.jsx)("div",{className:"recette-desc-thumbnails",children:C.images.map((e,t)=>(0,s.jsx)("div",{className:"recette-desc-thumbnail ".concat(t===T?"active":""),onClick:()=>{M(t),_.current&&clearInterval(_.current)},children:(0,s.jsx)("img",{src:e,alt:"".concat(C.title," - Thumbnail ").concat(t+1)})},t))})]})})]}),null==C?void 0:C.recipeParts.map((e,t)=>(0,s.jsxs)("div",{className:"recette-desc-part",children:[(0,s.jsx)("h2",{children:e.title}),(0,s.jsxs)("section",{children:[(0,s.jsxs)("div",{className:"recette-desc-part-ingredients",children:[(0,s.jsx)("h3",{children:"Ingr\xe9dients"}),(0,s.jsx)("ul",{children:e.ingredients.map((e,t)=>(0,s.jsx)("li",{children:(0,s.jsxs)("p",{children:[e.name," - ",e.quantity," ",e.unit]})},t))})]}),(0,s.jsxs)("div",{className:"recette-desc-part-steps",children:[(0,s.jsx)("h3",{children:"\xc9tapes de pr\xe9paration"}),(0,s.jsx)("ol",{children:e.steps.map((e,t)=>(0,s.jsx)("li",{children:(0,s.jsx)("h4",{children:e})},t))})]})]})]},t))]}),(0,s.jsxs)("div",{className:"recette-reviews-section",children:[(0,s.jsx)("h2",{children:"Avis et commentaires"}),(0,s.jsxs)("div",{className:"recette-reviews-container",children:[(0,s.jsxs)("div",{className:"recette-review-form",children:[(0,s.jsx)("h3",{children:"Partager votre avis"}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Votre note"}),(0,s.jsx)(k.G,{value:null!=$?$:void 0,onChange:e=>{var t;return G(null!=(t=e.value)?t:null)},cancel:!1})]}),(0,s.jsx)(E.Z,{value:F,onChange:e=>D(e.target.value),rows:4,placeholder:"Partagez votre exp\xe9rience...",className:"review-textarea"}),(0,s.jsx)(c.$,{label:"Envoyer mon avis",icon:"pi pi-send",onClick:H,disabled:!d,className:"submit-button"}),!d&&(0,s.jsx)("p",{className:"login-required",children:"Connectez-vous pour laisser un avis"})]}),(0,s.jsx)("div",{className:"recette-reviews-list-container",children:0===R.length?(0,s.jsx)("p",{className:"no-reviews",children:"Soyez le premier \xe0 laisser un avis !"}):(0,s.jsx)("ul",{className:"recette-reviews-list",children:R.map(e=>{var t,r,i,a;return(0,s.jsxs)("li",{className:"recette-review",children:[(0,s.jsxs)("div",{className:"recette-review-header",children:[(0,s.jsxs)("div",{className:"review-user-info",children:[(0,s.jsx)("strong",{children:e.userName}),(0,s.jsx)(k.G,{value:e.rating,readOnly:!0,cancel:!1})]}),d&&"admin"==o&&(0,s.jsx)(c.$,{icon:"pi pi-trash",onClick:()=>U(e.id),className:"p-button-danger p-button-rounded p-button-sm",tooltip:"Supprimer l'avis",tooltipOptions:{position:"bottom"}})]}),(0,s.jsx)("p",{className:"review-message",children:e.message}),(0,s.jsx)("small",{className:"review-date",children:(null==(i=e.createdAt)||null==(r=i.toDate)||null==(t=(a=r.call(i)).toLocaleString)?void 0:t.call(a))||""})]},e.id)})})})]})]})]})})};function I(){let e=(0,i.useSearchParams)(),t=null==e?void 0:e.get("id");return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:"Chargement..."}),children:t?(0,s.jsx)(C,{}):(0,s.jsx)(x,{})})}},9117:()=>{},9223:()=>{}},e=>{e.O(0,[8961,3268,9012,2992,9895,4797,1055,8296,29,6946,8574,3640,1056,2619,6489,2709,9062,5262,8441,1255,7358],()=>e(e.s=4698)),_N_E=e.O()}]);