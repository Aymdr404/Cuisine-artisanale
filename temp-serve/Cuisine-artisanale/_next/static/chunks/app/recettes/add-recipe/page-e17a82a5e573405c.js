(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2011],{1139:()=>{},2718:(e,t,s)=>{"use strict";s.d(t,{A:()=>d,O:()=>c});var i=s(5155),r=s(2115),a=s(5973),n=s(3885),l=s(9708);let o=(0,r.createContext)(void 0),c=e=>{let{children:t}=e,[s,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(null),[p,m]=(0,r.useState)(!0),[h,g]=(0,r.useState)(null),j=async e=>{let t=(0,l.aU)(),s=(0,l.H9)(t,"users",e),i=await (0,l.x7)(s);return i.exists()?i.data().role:null},x=async(e,t)=>{let s=(0,l.aU)(),i=(0,l.H9)(s,"users",e);await (0,l.BN)(i,{email:t,role:"user",createdAt:new Date})};(0,r.useEffect)(()=>{let e=(0,n.hg)(a.j,async e=>{try{if(e){c(e);let t=await j(e.uid);t?u(t):(await x(e.uid,e.email||""),u("user"))}else c(null),u(null)}catch(e){console.error("Error in auth state change:",e),g(e instanceof Error?e.message:"An error occurred")}finally{m(!1)}});return()=>e()},[]);let v=async()=>{try{g(null),await (0,n.CI)(a.j),u(null),window.location.href="/Cuisine-artisanale/"}catch(e){console.error("Error signing out:",e),g(e instanceof Error?e.message:"Error signing out")}},f=async()=>{try{g(null);let e=new n.HF,t=await (0,n.df)(a.j,e);t.user&&(await j(t.user.uid)||(await x(t.user.uid,t.user.email||""),u("user")))}catch(e){throw console.error("Error signing in with Google:",e),g(e instanceof Error?e.message:"Error signing in with Google"),e}};return(0,i.jsx)(o.Provider,{value:{user:s,role:d,logout:v,signInWithGoogle:f,loading:p,error:h},children:t})},d=()=>{let e=(0,r.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},2900:(e,t,s)=>{Promise.resolve().then(s.bind(s,9806))},9806:(e,t,s)=>{"use strict";s.d(t,{default:()=>x});var i=s(5155),r=s(2115);s(1139);var a=s(4340),n=s(29),l=s(6218),o=s(2165),c=s(6097),d=s(5973),u=s(9708),p=s(8134),m=s(2718),h=s(2008),g=s(4064),j=s(3050);let x=()=>{let{user:e}=(0,m.A)(),t="",[s,x]=(0,r.useState)(1),{showToast:v}=(0,g.d)(),[f,b]=(0,r.useState)(""),[N,y]=(0,r.useState)(null),[w,C]=(0,r.useState)(null),[S,k]=(0,r.useState)(null),[E,D]=(0,r.useState)(""),[T,I]=(0,r.useState)(""),[q,A]=(0,r.useState)(!1),[F,R]=(0,r.useState)([{title:"Recette 1",steps:[],ingredients:{},selectedIngredients:[]}]),[P,z]=(0,r.useState)([]),[L,V]=(0,r.useState)([]),_={nom:"Aucun d\xe9partement",code:"none"},[$,U]=(0,r.useState)(_),[B,H]=(0,r.useState)([]),[Y,G]=(0,r.useState)(!1),[K,O]=(0,r.useState)([]),[J,M]=(0,r.useState)(F.map(()=>[])),[Q,Z]=(0,r.useState)(!1),[W,X]=(0,r.useState)(""),[ee,et]=(0,r.useState)(null),[es,ei]=(0,r.useState)(F.map(()=>"")),er=(e,t)=>{ei(s=>{let i=[...s];return i[t]=e,i})},ea=(e,t)=>{let s=[...F];s[t].selectedIngredients.push(e.id),s[t].ingredients[e.id]="0",R(s),er("",t)},en=[{id:1,name:"Entr\xe9e"},{id:2,name:"Plat"},{id:3,name:"Dessert"},{id:4,name:"Boisson"}],el=async s=>{var i;if(console.log("Submitting form..."),s.preventDefault(),C(null!=w?w:0),k(null!=S?S:0),!f||!N||null===w||null===S||!F.every(e=>e.steps.every(e=>""!==e.trim())))return void alert("Veuillez remplir tous les champs");if(E&&!/^(https?:\/\/)?(www\.)?(tiktok\.com|instagram\.com|youtu\.be|youtube\.com|facebook\.com)\/.+$/i.test(E))return void I("Veuillez entrer une URL vid\xe9o TikTok, Instagram ou YouTube valide.");I("");let r=f.charAt(0).toUpperCase()+f.slice(1),a=null==(i=en.find(e=>e.id===N))?void 0:i.name,n=F.map(e=>({...e,ingredients:e.selectedIngredients.map(t=>{let s=L.find(e=>e.id===t.toString());return s?{id:s.id,name:s.name,quantity:e.ingredients[t]||"0",unit:s.unit||""}:null}).filter(Boolean)}));if(!q){console.log("Creating new recette...");try{t=(await (0,u.gS)((0,u.rJ)(d.db,"recipesRequest"),{title:"",type:"",preparationTime:"",cookingTime:"",video:"",images:[],recipeParts:[],position:"",createdBy:"",titleKeywords:[],url:""})).id,A(!0)}catch(e){console.error("Error creating recette:",e)}console.log("Recette ID after creation:",t);try{let s=(0,u.H9)(d.db,"recipesRequest",t);1==n.length&&(n[0].title=r),await (0,u.mZ)(s,{title:r,type:a,preparationTime:w,cookingTime:S,video:E,id:t,createdAt:new Date,recipeParts:n,position:(null==$?void 0:$.code)||"none",createdBy:null==e?void 0:e.uid,images:K,titleKeywords:r.toLowerCase().split(" "),url:r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s-]/g,"").trim().replace(/\s+/g,"_").toLowerCase()}),b(""),y(null),C(0),k(0),D(""),R([{title:"Recette 1",steps:[],ingredients:{},selectedIngredients:[]}]),U(_),O([]),A(!1),ed(),h.oR.success("Recette envoy\xe9e \xe0 la v\xe9rification admin")}catch(e){console.error("Error updating recette:",e)}}};(0,r.useEffect)(()=>{fetch("https://geo.api.gouv.fr/departements").then(e=>e.json()).then(e=>{z([_,...e.map(e=>({nom:e.nom,code:e.code}))])}),eo()},[]);let eo=async()=>{try{let e=(0,u.rJ)(d.db,"ingredients"),t=(0,u.P)(e),s=(await (0,u.GG)(t)).docs.map(e=>{let t=e.data();return{name:t.name,id:e.id,unit:t.unit||""}});V(s)}catch(e){console.error("Error getting recettes: ",e)}},ec=async()=>{if(0===B.length)return;G(!0);let e=[];for(let t of B){let s=(0,p.KR)(d.I,"recipes/".concat(f,"/").concat(t.name)),i=(0,p.bp)(s,t);await new Promise((t,s)=>{i.on("state_changed",null,e=>{console.error("Upload failed:",e),s(e)},async()=>{let s=await (0,p.qk)(i.snapshot.ref);e.push(s),t()})})}O(e),G(!1)},ed=()=>{window.history.back()};return(0,i.jsxs)("div",{className:"add-recipe-container",children:[(0,i.jsxs)("header",{className:"add-recipe-header",children:[(0,i.jsx)("h1",{children:"Composer votre propre recette"}),(0,i.jsx)("p",{className:"subtitle",children:"Les champs marqu\xe9s d'un * sont obligatoires"})]}),(0,i.jsxs)("div",{className:"step-progress",children:["\xc9tape ",s," sur ",5,(0,i.jsx)("div",{className:"progress-bar",children:(0,i.jsx)("div",{className:"progress",style:{width:"".concat(s/5*100,"%")}})})]}),(0,i.jsxs)("form",{onSubmit:el,className:"recipe-form",children:[(0,i.jsxs)("div",{className:"form-grid",children:[1===s&&(0,i.jsxs)("section",{className:"form-section basic-info",children:[(0,i.jsx)("h2",{children:"Cr\xe9ation de votre recette"}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"title",children:"Titre *"}),(0,i.jsx)(a.S,{id:"title",value:f,onChange:e=>b(e.target.value),placeholder:"Entrez le titre",required:!0})]}),(0,i.jsx)("p",{children:(0,i.jsx)("i",{children:"Elle sera analys\xe9e et trait\xe9e dans les plus brefs d\xe9lais par nos \xe9quipes."})}),(0,i.jsx)("p",{children:(0,i.jsx)("i",{children:"Si votre recette respecte nos crit\xe8res, elle sera publi\xe9e sur notre plateforme."})})]}),2===s&&(0,i.jsxs)("section",{className:"form-section timing",children:[(0,i.jsxs)("div",{className:"type-section",children:[(0,i.jsx)("h2",{children:"Type et origine"}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"type",children:"Type de plat *"}),(0,i.jsx)(l.m,{id:"type",value:N,options:en,onChange:e=>y(e.value),optionLabel:"name",optionValue:"id",placeholder:"S\xe9lectionnez un type",required:!0})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"position",children:"D\xe9partement d'origine"}),(0,i.jsx)(l.m,{id:"position",value:$,options:P,onChange:e=>U(e.value),optionLabel:"nom",optionValue:"code",placeholder:"S\xe9lectionnez un d\xe9partement"})]})]}),(0,i.jsxs)("div",{className:"time-inputs",children:[(0,i.jsx)("h2",{children:"Temps de pr\xe9paration"}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"preparationTime",children:"Pr\xe9paration (min) *"}),(0,i.jsx)(o.Y,{id:"preparationTime",value:w,onChange:e=>C(e.value),min:0,required:!0,mode:"decimal",locale:"fr-FR"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"cookingTime",children:"Cuisson (min) *"}),(0,i.jsx)(o.Y,{id:"cookingTime",value:S,onChange:e=>k(e.value),min:0,required:!0,mode:"decimal",locale:"fr-FR"})]})]})]}),3===s&&(0,i.jsxs)("section",{className:"form-section ingredients",children:[(0,i.jsx)(j.A,{visible:Q,onHide:()=>Z(!1),initialName:W,onIngredientCreated:e=>{V(t=>[...t,e]),ea(e,null!==ee?ee:0),Z(!1)}}),(0,i.jsx)("h2",{children:"Ingr\xe9dients *"}),F.map((e,t)=>(0,i.jsxs)("div",{className:"part-ingredients",children:[(0,i.jsx)("h3",{children:e.title}),(0,i.jsx)(c.j,{field:"name",suggestions:J[t]||[],completeMethod:e=>((e,t)=>{let s=L.filter(s=>s.name.toLowerCase().includes(e.toLowerCase())&&!F[t].selectedIngredients.includes(s.id)),i=""!==e.trim()?[{id:"new",name:'➕ Cr\xe9er "'.concat(e,'"'),isNew:!0,rawName:e},...s]:s;M(e=>{let s=[...e];return s[t]=i,s})})(e.query,t),placeholder:"Tapez un ingr\xe9dient",value:es[t],onChange:e=>{"string"==typeof e.value&&er(e.value,t)},onSelect:e=>{let s=e.value;"new"===s.id?(X(s.name.replace('➕ Cr\xe9er "',"").replace('"',"")),Z(!0),et(t)):ea(s,t),er("",t)},dropdown:!0,onKeyDown:e=>{if("Enter"===e.key){e.preventDefault();let s=J[t]||[];s.length>0&&ea(s[0],t),er("",t)}}}),(0,i.jsx)("section",{className:"ingredient-quantities",children:e.selectedIngredients.map(s=>{let r=L.find(e=>e.id===s);return(0,i.jsxs)("div",{className:"ingredient-item",children:[(0,i.jsx)("span",{children:null==r?void 0:r.name}),(0,i.jsx)(o.Y,{value:e.ingredients[s]?parseFloat(e.ingredients[s]):null,onChange:e=>{var i;return((e,t,s)=>{let i=[...F];i[e].ingredients[t]=s,R(i)})(t,s,(null==(i=e.value)?void 0:i.toString())||"0")},placeholder:"Quantit\xe9",min:0,mode:"decimal"}),(0,i.jsx)("span",{children:null==r?void 0:r.unit}),(0,i.jsx)("button",{type:"button",className:"remove-ingredient-btn",onClick:()=>((e,t)=>{let s=[...F];s[e].selectedIngredients=s[e].selectedIngredients.filter(e=>e!==t),delete s[e].ingredients[t],R(s)})(t,s),title:"Supprimer cet ingr\xe9dient",children:"❌"})]},s)})})]},t))]}),4===s&&(0,i.jsxs)("section",{className:"form-section steps",children:[(0,i.jsx)("h2",{children:"\uD83E\uDDD1‍\uD83C\uDF73 \xc9tapes de pr\xe9paration *"}),(0,i.jsx)("p",{className:"section-subtitle",children:"Ajoute les \xe9tapes de chaque partie de ta recette (ex: p\xe2te \xe0 cookie, brownie...)."}),(0,i.jsx)(n.$,{type:"button",label:"Ajouter une sous-recette",icon:"pi pi-plus",className:"p-button-text p-button-sm",onClick:()=>{R([...F,{title:"Recette ".concat(F.length+1),steps:[],ingredients:{},selectedIngredients:[]}]),v({severity:"info",summary:"Nouvelle sous-recette",detail:"Penser a ajouter les ingr\xe9dients dans la page pr\xe9c\xe9dente.",life:2e3})}}),F.map((e,t)=>(0,i.jsxs)("div",{className:"recipe-part-steps",children:[(0,i.jsxs)("div",{className:"part-header",children:[(0,i.jsx)("h3",{children:e.title}),0!==t&&(0,i.jsx)("button",{type:"button",className:"delete-part-btn",onClick:()=>{R(F.filter((e,s)=>s!==t))},title:"Supprimer cette sous-recette",children:(0,i.jsx)("i",{className:"pi pi-trash"})})]}),e.steps.map((e,s)=>(0,i.jsxs)("div",{className:"step-card",children:[(0,i.jsxs)("div",{className:"step-header",children:[(0,i.jsx)("span",{className:"step-number",children:s+1}),(0,i.jsxs)("label",{children:["\xc9tape ",s+1]}),(0,i.jsx)("button",{type:"button",className:"delete-step-btn",onClick:()=>((e,t)=>{let s=[...F];s[e].steps=s[e].steps.filter((e,s)=>s!==t),R(s)})(t,s),title:"Supprimer cette \xe9tape",children:(0,i.jsx)("i",{className:"pi pi-trash"})})]}),(0,i.jsx)("textarea",{className:"step-textarea",placeholder:"D\xe9cris cette \xe9tape de pr\xe9paration...",value:e,onChange:e=>((e,t,s)=>{let i=[...F];i[e].steps[t]=s,R(i)})(t,s,e.target.value),rows:3})]},s)),(0,i.jsxs)("button",{type:"button",className:"add-step-btn",onClick:()=>(e=>{let t=[...F];t[e].steps.push(""),R(t)})(t),children:[(0,i.jsx)("i",{className:"pi pi-plus"})," Ajouter une \xe9tape \xe0 ",e.title]})]},t))]}),5===s&&(0,i.jsxs)("section",{className:"form-section media",children:[(0,i.jsx)("h2",{children:"\uD83D\uDCF8 M\xe9dias"}),(0,i.jsx)("p",{className:"section-subtitle",children:"Ajoute une vid\xe9o (facultatif) et t\xe9l\xe9verse quelques images illustrant ta recette."}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"video",children:"Lien vid\xe9o"}),(0,i.jsx)(a.S,{id:"video",value:E,onChange:e=>D(e.target.value),placeholder:"URL TikTok, Instagram, YouTube...",className:"video-input"}),T&&(0,i.jsx)("div",{className:"error-message",children:T})]}),(0,i.jsxs)("div",{className:"form-group upload-section",children:[(0,i.jsx)("h3",{children:"Images"}),(0,i.jsxs)("div",{className:"upload-actions",children:[(0,i.jsxs)("label",{htmlFor:"file-upload",className:"custom-file-upload",children:[(0,i.jsx)("i",{className:"pi pi-image"})," S\xe9lectionner des images"]}),(0,i.jsx)("input",{id:"file-upload",type:"file",multiple:!0,onChange:e=>{H([...e.target.files])},accept:"image/*"}),(0,i.jsx)(n.$,{label:Y?"T\xe9l\xe9chargement...":"T\xe9l\xe9charger",icon:"pi pi-upload",onClick:ec,disabled:0===B.length||Y})]}),B.length>0&&!Y&&(0,i.jsxs)("p",{className:"upload-info",children:[B.length," image",B.length>1?"s":""," s\xe9lectionn\xe9e",B.length>1?"s":"","."]})]}),K.length>0&&(0,i.jsx)("div",{className:"image-grid",children:K.map((e,t)=>(0,i.jsx)("div",{className:"image-card",children:(0,i.jsx)("img",{src:e,alt:"Preview ".concat(t+1),className:"image-preview"})},t))})]})]}),(0,i.jsxs)("footer",{className:"form-actions",children:[s>1&&(0,i.jsx)(n.$,{type:"button",label:"Pr\xe9c\xe9dent",icon:"pi pi-arrow-left",className:"p-button-secondary",onClick:()=>{s>1&&x(s-1)}}),s<5?(0,i.jsx)(n.$,{type:"button",label:"Suivant",icon:"pi pi-arrow-right",className:"p-button-primary",onClick:e=>{null==e||e.preventDefault();let t=!0,i="";switch(s){case 1:f.trim()||(t=!1,i="Veuillez entrer un titre pour votre recette.");break;case 2:N&&null!==w&&null!==S||(t=!1,i="Veuillez remplir le type de plat et les temps de pr\xe9paration/cuisson.");break;case 3:F.some(e=>e.selectedIngredients.length>0)||(t=!1,i="Veuillez ajouter au moins un ingr\xe9dient.");break;case 4:F.every(e=>e.steps.length>0&&e.steps.every(e=>""!==e.trim()))||(t=!1,i="Veuillez d\xe9crire au moins une \xe9tape de pr\xe9paration.")}if(!t)return void h.oR.error(i);s<5&&x(s+1)}}):(0,i.jsx)(n.$,{type:"submit",label:"Cr\xe9er la recette",icon:"pi pi-check",className:"p-button-success"}),(0,i.jsx)(n.$,{type:"button",label:"Annuler",icon:"pi pi-times",className:"cancel-button",onClick:ed})]})]})]})}}},e=>{e.O(0,[3692,8472,9844,2992,9895,4797,1055,8296,29,6946,8574,3640,1056,2165,2008,6097,3050,8441,1255,7358],()=>e(e.s=2900)),_N_E=e.O()}]);